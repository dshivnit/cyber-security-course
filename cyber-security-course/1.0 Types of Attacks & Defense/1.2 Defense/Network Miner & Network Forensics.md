https://tryhackme.com/r/room/networkminer
https://www.netresec.com/?page=NetworkMiner

- **NetworkMiner is a great tool to be able to efficiently pick 'low hanging fruit' !**
	- But by all means, do not keep this as a primary tool, but a supplemental one
	- NetworkMiner -> Wireshark / Tcpdump and so on
- Open-source traffic sniffer, pcap handler, and protocol analyser
- Developed and maintained by Netresec
- Can be used as a passive network sniffer/packet capturing tool
	- Detects
		- OSs
		- Sessions
		- Hostnames
		- Open ports
		- etc
	- It does this without putting any traffic on the network
- Can also parse PCAP files for off-line analysis and to regenerate/reassemble transmitted files and certificates from PCAP files
- Makes it easy to perform advanced NTA (Network Traffic Analysis) by providing extracted artefacts in an intuitive user interface
	- Good way to save an analyst some time

Network Forensics
- A specific sub-domain of the Forensics domain
	- Focuses on network traffic, investigation
- Covers the work done to access information transmitted by listening and investigating live and recorded traffic, gathering evidence/artefacts and understanding potential problems
- The action of recording network traffic/packets and creating investigatable sources and establishing a root-cause analysis of an event. 
- The ultimate goal is to provide sufficient information to detect malicious activities, security breaches, policy/regulation compliance, system health and user behaviour
- Identifies:
	- Time
	- Frequency
	- Protocol
	- Application
	- and Data
- The investigation will try to answer:
	- Who (Source IP and Port)
	- What (Data/payload)
	- Where (Destination IP and port)
	- When (Time and data)
	- Why (How/What happened)

**The network evidence capture and investigation process should be systematic.
Having enough data and the right timeline capture for a successful network forensics investigation is crucial**

Network Forensics Use Cases (most common)
- Network discovery:
	- Discovering the network to overview connected devices, rogue hosts and network load
- Packets reassembling
	- Reassembling the packets to investigate the traffic flow. This use case is helpful in unencrypted traffic flows
- Data leakage detection
	- Reviewing packet transfer rates for each host and destination address helps detect possible data leakage
- Anomaly and malicious activity detection:
	- Reviewing overall network load by focusing on used ports, source and destinations addresses along with data, helps to detect possible malicious activities along with vulnerabilities. 
	- The use case covers the correlation of indicators and hypotheses as well
- Policy regulation/compliance control
	- Reviewing overall network behaviour helps detect policy/regulation compliance

Advantages of Network Forensics
- Availability of network-based evidence in the wild:
	- Capturing network traffic is collecting evidence, so it is easier than other types of evidence collections such as logs and IOCs
- Ease of data/evidence collection without creating noise
	- Capturing and working with network traffic is easier than investigating unfiltered events by EDRs, EPPs and log systems
	- Usually, sniffing doesn't create much noise, logs and alerts. 
	- The other thing is that network traffic is not destructible like logs and alerts generated by security systems
- It is hard to destroy the network evidence, as it is the transferred data
	- Since the evidence is the traffic itself, it is impossible to do anything without creating network nosie
	- Still, it is possible to hide the artefacts by encrypting, tunneling and manipulating the packets
	- So the second fact is the challenge of this advantage
- **Availability of log sources**
	- Logs provide valuable information which helps to correlate the chain of events and support the investigation hypothesis. 
	- The majority of the EDRs , EPPs and network devices create logs by default
	- Having log files is easy if the attacker/threat/malware didn't erase/destroy them
- **It is possible to gather evidence for memory and non-residential malicious activities**
	- The malware/threat might reside in physical memory to avoid detection
	- However, the series of commands and connections live in the network(s)
	- So it is possible to detect non-residential threats with network forensics tools and tactics

Challenges of Network Forensics (some general ones)
- Deciding what to do
	- There are several purposes of carving networks, SOC, IH/IR, and threat hunting
	- Observing, trapping, catching, or stopping an anomalous activity is also possible
- Sufficient data/evidence collection on the network
	- One of the advantages of network forensics is "ease of collecting evidence" 
	- However, the breadth of this concept poses a challenge
	- There are multiple points to consider in data/evidence collection
- Short data capture
	- Capturing all network activity is not applicable and operable
	- It is hard to always have packet captures that will cover the pre, during, and post-events
- The unavailability of full-packet capture on suspicious events
	- Continuously capturing, storing and processing full-packets costs time and resources
	- The inability to have full packet captures for a long time creates time gaps between captures, resulting in missing a significant part of an event of interest. 
	- Sometimes NetFlow captures are used instead of full-packet captures to reduce the weight of having full-packet captures and increase the capture time. 
	- Full-packet captures provide full packet details and give the opportunity of event reconstruction
		- While NetFlow provides high-level summary but not data/payload details
- Encrypted Traffic
	- Discovering the contents of encrypted data is not possible
	- However, encrypted data can still provide valuable information for the hypothesis like source and destination address and used services
- GDPR and Privacy concerns in traffic recording
	- Capturing traffic is the same as "recording everything on the wire"
		- Therefore, this act should comply with local regulations like the GDPR and business-specific regulations, such as HIPAA and PCI-DSS and FISMA
- Nonstandard Port Usage
	- One popular approach in network forensics is grabbing low-hanging fruits in the first investigation step
	- Looking for commonly used patterns (like known ports and services used in enumeration and exploitation)
		- is known as grabbing the low-hanging fruits
	- Sometimes though, attackers/threats use nonstandard ports and services to avoid detection and bypass security mechanisms
	- This can end up being a challenge
- Time zone issues
	- Using a common time zone is important for big-scale event investigation
	- Especially when working with multiple resources over different time zones
	- Usage of different time zones creates difficulties in event correlation
- Lack of logs
	- Usually attackers/threats will erase logs. Logs are usually crucial in an investigation

Sources of Network Forensics Evidence
- TAPS
- InLine Devices
- SPAN Ports
- Hubs
- Switches
- Routers
- DHCP Servers
- Name Servers
- Authentication Servers
- Firewalls
- Web Proxies
- Central Log Servers
- Logs (IDS/IPS, application, OS, device)

Primary Purposes of Network Forensics
- Two primary purposes:
	- Security Operations (SOC)
		- Daily security monitoring activities on system performance and health, user behaviour, and security issues
	- Incident Handling/Response and Threat Hunting
		- During/Post-incident investigation activities on understanding the reason for the incident, detecting malicious and suspicious activity, and investigating the data flow content

Investigated Data Types in Network Forensics
- Three main data types investigated:
	- Live Traffic
	- Traffic Captures (full packet captures and network flows)
	- Log Files

- Traffic Investigations fall under Network Forensics' "Traffic Analysis."
- The main purpose of NetworkMiner is to investigate the overall flow/condition of the limited amount of traffic, not for a long in-depth live traffic investigation

**In-depth** Traffic and Packet analysis will be covered by:
- Wireshark
- Tcpdump
- Tshark

NetworkMiner in a Nutshell:
- Traffic sniffing
	- Intercepts traffic, sniffs it, collects and logs packets that pass through the network
- Parsing PCAP files
	- Parses pcap files and shows the contents of packets in detail
- Protocol analysis
	- Identifies protocols that are used from the parsed pcap file
- OS fingerprinting
	- Identifies the used OS via the pcap file
	- Relies on Satori and p0f
		- Satori
			- https://github.com/xnih/satori/
			- Python rewrite of passive OS fingerprinting tool
		- p0f
			- https://lcamtuf.coredump.cx/p0f3/
			- Utilises an array of sophisticated, purely passive traffic fingerprinting mechanisms to identify the players behind any incidental TCP/IP communication without interfering
- File extraction
	- Can extract images, HTML files and emails from parsed pcap files
- Credential grabbing
	- Can extract credentials from a parsed pcap file
- Clear text keyword parsing
	- Can extract cleartext keywords and strings from the parsed pcap file

Operating Modes
- Sniffer Mode
	- Only available on Windows
	- Sniffing feature is not as reliable as other features
	- Don't use this as a primary sniffer
- Packet Parsing/Processing
	- Can parse traffic captures to have a quick overview and information on the investigated capture. 
	- Mainly suggested to grab the 'low hanging fruit' before diving into a deeper investigation

Pros and Cons
	As mentioned, NetworkMiner is mainly used to gain an overview of the network.
- Pros:
	- OS fingerprinting
	- Easy file extraction
	- Credential grabbing
	- Clear text keyword passing
	- Overall overview
- Cons
	- Not useful in active sniffing
	- Not useful for large pcap investigation
	- Limited filtering
	- Not built for manual traffic investigation

Note: Wireshark > NetworkMiner
- Wireshark, HOWEVER, doesn't provide OS fingerprinting (which can be useful!)
		As well as with Host Categorisation

**PCAP OVER IP!!**
- Can receive pcaps over IP
	- Older, but probably still relevant information
		- https://www.netresec.com/?page=Blog&month=2011-09&post=Pcap-over-IP-in-NetworkMiner
		- https://www.gavinhollinger.com/2016/10/pcap-over-ip-to-networkminer.html
		- https://www.netresec.com/?page=Blog&month=2022-05&post=Real-time-PCAP-over-IP-in-Wireshark

	

